<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Burmalda: Grand Cities</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #f1c40f; --green: #2ecc71; --red: #e74c3c; --bg: #0a0a0a; --panel: #161616; --blue: #3498db; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; text-align: center; user-select: none; overflow: hidden; }
        
        .top-bar { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: var(--panel); border-bottom: 2px solid #333; height: 50px; }
        .balance { font-size: 18px; color: var(--gold); font-weight: bold; }
        
        .tab-content { display: none; padding: 15px; height: calc(100vh - 140px); overflow-y: auto; padding-bottom: 80px; }
        .active-tab { display: block; }

        /* –ö–ù–û–ü–ö–ò –ì–û–†–û–î–û–í –ù–ê –ö–ê–†–¢–ï */
        .city-card { background: #222; border: 2px solid var(--blue); border-radius: 15px; padding: 15px; margin-bottom: 15px; cursor: pointer; transition: 0.3s; }
        .city-card:active { transform: scale(0.95); background: #333; }
        .city-card h2 { margin: 0 0 5px 0; color: var(--gold); }
        .city-card p { margin: 0; font-size: 12px; color: #aaa; }

        /* –ú–ï–ù–Æ –í–ù–£–¢–†–ò –ì–û–†–û–î–ê */
        .city-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .menu-btn { background: var(--panel); border: 1px solid #444; padding: 20px 10px; border-radius: 12px; color: white; font-weight: bold; font-size: 13px; }
        .menu-btn:active { background: #333; }

        /* –ò–ì–†–û–í–´–ï –ö–ê–†–¢–´ */
        .game-card { background: var(--panel); padding: 15px; border-radius: 18px; margin-bottom: 15px; border: 1px solid #333; }
        .slot-container { display: flex; justify-content: center; gap: 8px; margin: 10px 0; }
        .slot-box { width: 50px; height: 65px; background: #000; border: 2px solid var(--gold); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 28px; }

        .click-btn { 
            width: 160px; height: 160px; border-radius: 50%; border: 8px solid #222; 
            background: radial-gradient(circle, var(--gold) 0%, #d4ac0d 100%); color: black; font-size: 18px; font-weight: 900;
            margin-top: 40px; box-shadow: 0 0 20px rgba(241, 196, 15, 0.2);
        }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø –í–ù–ò–ó–£ */
        .nav { position: fixed; bottom: 0; width: 100%; background: var(--panel); display: flex; height: 70px; border-top: 2px solid #333; }
        .nav-btn { flex: 1; background: none; border: none; color: #555; font-size: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .nav-btn.active { color: var(--gold); }
        .nav-btn span { font-size: 22px; margin-bottom: 2px; }

        .buy-btn { background: var(--green); border: none; color: white; padding: 8px; border-radius: 5px; font-weight: bold; }
        .list-item { background: #1a1a1a; padding: 10px; margin: 5px 0; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; font-size: 14px; }
        input { background: #222; color: white; border: 1px solid #444; padding: 5px; border-radius: 5px; width: 60px; text-align: center; }
    </style>
</head>
<body onload="initGame()">

<div class="top-bar">
    <div class="balance"><span id="coins">0</span> ü™ô</div>
    <div style="display:flex; gap:10px;">
        <button class="icon-btn" onclick="openTab('profile')" style="background:none; border:none; font-size:20px;">üë§</button>
        <button class="icon-btn" onclick="openTab('settings')" style="background:none; border:none; font-size:20px;">‚öôÔ∏è</button>
    </div>
</div>

<div id="tab-clicker" class="tab-content active-tab">
    <h3>–ö–õ–ò–ö–ï–†</h3>
    <button class="click-btn" onclick="makeClick(event)">–ë–£–†–ú–ê–õ–î–ê</button>
    <p style="margin-top:20px; color:#777;">–≠–Ω–µ—Ä–≥–∏—è: <span id="energy">1000</span>‚ö°</p>
</div>

<div id="tab-map" class="tab-content">
    <h3>–ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –ö–ê–†–¢–ê</h3>
    <div class="city-card" onclick="travelTo('Murino')">
        <h2>üèóÔ∏è –ú—É—Ä–∏–Ω–æ</h2>
        <p>–†–∞–±–æ—Ç–∞, –ê–≤—Ç–æ-–°–∞–ª–æ–Ω, –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</p>
    </div>
    <div class="city-card" onclick="travelTo('OtsoCity')">
        <h2>üé∞ –û—Ç—Å–æ-–°–∏—Ç–∏</h2>
        <p>–ö–∞–∑–∏–Ω–æ, –ö—Ä–∞—à, –ú–∞–≥–∞–∑–∏–Ω</p>
    </div>
    <div class="city-card" onclick="travelTo('Medno')">
        <h2>üé° –ú–µ–¥–Ω–æ–±—ã—á–µ–Ω—Å–∫</h2>
        <p>–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è –∏ –æ—Ç–¥—ã—Ö</p>
    </div>
</div>

<div id="tab-city" class="tab-content">
    <h3 id="city-name">–í–´–ë–ï–†–ò–¢–ï –ì–û–†–û–î</h3>
    <div id="city-welcome" style="margin-top:50px; color:#555;">–ó–∞–π–¥–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è –≤ –ø—É—Ç—å.</div>
    
    <div id="menu-Murino" class="city-menu" style="display:none;">
        <button class="menu-btn" onclick="showSubTab('cars')">üèéÔ∏è –ê–≤—Ç–æ-–°–∞–ª–æ–Ω</button>
        <button class="menu-btn" onclick="showSubTab('realty')">üè† –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</button>
        <button class="menu-btn" onclick="showSubTab('shop')">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
        <button class="menu-btn" onclick="showSubTab('work')">üõ†Ô∏è –†–∞–±–æ—Ç—ã</button>
    </div>

    <div id="menu-OtsoCity" class="city-menu" style="display:none;">
        <button class="menu-btn" onclick="showSubTab('casino')">üé∞ –ö–∞–∑–∏–Ω–æ</button>
        <button class="menu-btn" onclick="showSubTab('crash')">üöÄ –ö—Ä–∞—à</button>
        <button class="menu-btn" onclick="showSubTab('shop')">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
        <button class="menu-btn" onclick="showSubTab('realty')">üè¢ –ù–µ–¥–≤–∏–∂–∫–∞</button>
    </div>

    <div id="menu-Medno" class="city-menu" style="display:none;">
        <button class="menu-btn" onclick="openTab('clicker')">üéØ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</button>
        <button class="menu-btn" onclick="tg.showAlert('–¢—É—Ç –ø–æ–∫–∞ —Å—Ç—Ä–æ–∏—Ç—Å—è –ø–∞—Ä–∫!')">üå≥ –ü–∞—Ä–∫</button>
    </div>

    <div id="sub-content" style="margin-top:20px;"></div>
</div>

<div id="tpl-cars" style="display:none;">
    <h4>–ê–í–¢–û-–°–ê–õ–û–ù</h4>
    <div id="list-cars"></div>
</div>
<div id="tpl-casino" style="display:none;">
    <div class="game-card">
        <h3>üé∞ –ö–ê–ó–ò–ù–û</h3>
        <div class="slot-container">
            <div class="slot-box" id="s1">üçí</div><div class="slot-box" id="s2">üçí</div><div class="slot-box" id="s3">üçí</div>
        </div>
        <input type="number" id="slot-bet" value="100">
        <button onclick="playSlots()" style="width:100%; padding:10px; background:var(--red); border:none; border-radius:8px; color:white; margin-top:10px;">–ö–†–£–¢–ò–¢–¨</button>
    </div>
</div>
<div id="tpl-crash" style="display:none;">
    <div class="game-card">
        <h3>üöÄ CRASH</h3>
        <div id="crash-display" style="font-size:30px; color:var(--gold);">1.00x</div>
        <input type="number" id="crash-bet" value="100"><br><br>
        <button id="btn-crash-start" onclick="startCrash()" style="padding:10px; background:var(--green); border:none; border-radius:5px; color:white;">–°–¢–ê–í–ö–ê</button>
        <button id="btn-crash-cashout" onclick="cashoutCrash()" disabled style="padding:10px; background:var(--gold); border:none; border-radius:5px;">–ó–ê–ë–†–ê–¢–¨</button>
    </div>
</div>

<div id="tab-profile" class="tab-content">
    <h3>–ü–†–û–§–ò–õ–¨</h3>
    <p>–í—Å–µ–≥–æ –¥–æ–±—ã—Ç–æ: <span id="prof-total">0</span></p>
    <button onclick="takeSnapshot()" style="padding:10px; background:var(--blue); border:none; border-radius:8px; color:white;">üì∏ –°–ù–ê–ü–®–û–¢ (24—á)</button>
</div>
<div id="tab-settings" class="tab-content">
    <h3>–ù–ê–°–¢–†–û–ô–ö–ò</h3>
    <button onclick="resetGame()" style="padding:15px; background:var(--red); border:none; border-radius:10px; color:white;">–°–ë–†–û–° –ü–†–û–ì–†–ï–°–°–ê</button>
    <p><input type="checkbox" id="set-sound" checked> –ó–≤—É–∫</p>
</div>

<div class="nav">
    <button class="nav-btn active" id="n-clicker" onclick="openTab('clicker')"><span>üñ±Ô∏è</span>–ö–ª–∏–∫</button>
    <button class="nav-btn" id="n-map" onclick="openTab('map')"><span>üó∫Ô∏è</span>–ö–∞—Ä—Ç–∞</button>
    <button class="nav-btn" id="n-city" onclick="openTab('city')"><span>üèôÔ∏è</span>–ì–æ—Ä–æ–¥</button>
</div>

<script>
    let coins = 0, energy = 1000, currentCity = null, income = 0, clickPower = 1, totalEarned = 0;
    const tg = window.Telegram.WebApp;
    const snd = { click: new Audio('click.mp3'), win: new Audio('win.mp3'), lose: new Audio('loss.mp3'), jackpot: new Audio('jackpot.mp3'), music: new Audio('music.mp3') };
    snd.music.loop = true;

    let cars = [{ name: "–ñ–∏–≥—É–ª–∏", price: 5000, inc: 2, click: 5, count: 0 }, { name: "M5", price: 50000, inc: 20, click: 30, count: 0 }];

    function initGame() {
        loadData(); updateUI();
        setInterval(() => { coins += income; totalEarned += income; if(energy < 1000) energy++; updateUI(); }, 1000);
    }

    function travelTo(cityId) {
        currentCity = cityId;
        const names = { Murino: "–ú—É—Ä–∏–Ω–æ", OtsoCity: "–û—Ç—Å–æ-–°–∏—Ç–∏", Medno: "–ú–µ–¥–Ω–æ–±—ã—á–µ–Ω—Å–∫" };
        document.getElementById('city-name').innerText = names[cityId];
        document.getElementById('city-welcome').style.display = 'none';
        
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–µ–Ω—é –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω–æ–µ
        ['Murino', 'OtsoCity', 'Medno'].forEach(id => document.getElementById('menu-'+id).style.display = 'none');
        document.getElementById('menu-'+cityId).style.display = 'grid';
        document.getElementById('sub-content').innerHTML = ""; // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–µ–∑–¥–µ
        
        openTab('city');
        tg.showAlert("–í—ã –ø—Ä–∏–±—ã–ª–∏ –≤ " + names[cityId]);
    }

    function showSubTab(type) {
        const sub = document.getElementById('sub-content');
        if(type === 'cars') {
            sub.innerHTML = document.getElementById('tpl-cars').innerHTML;
            renderCars();
        } else if(type === 'casino') {
            sub.innerHTML = document.getElementById('tpl-casino').innerHTML;
        } else if(type === 'crash') {
            sub.innerHTML = document.getElementById('tpl-crash').innerHTML;
        } else {
            sub.innerHTML = "<h4>–ó–¥–µ—Å—å –ø–æ–∫–∞ –ø—É—Å—Ç–æ</h4>";
        }
    }

    function renderCars() {
        const list = document.getElementById('list-cars');
        if(!list) return;
        list.innerHTML = cars.map((c, i) => `
            <div class="list-item">
                <span>${c.name} (x${c.count})</span>
                <button class="buy-btn" onclick="buyCar(${i})">${Math.floor(c.price)}</button>
            </div>
        `).join('');
    }

    function buyCar(i) {
        if(coins >= cars[i].price) {
            coins -= cars[i].price; income += cars[i].inc; clickPower += cars[i].click;
            cars[i].count++; cars[i].price *= 2.1;
            renderCars(); updateUI();
        }
    }

    // --- –õ–û–ì–ò–ö–ê –°–õ–û–¢–û–í –ò –ö–†–ê–®–ê (–°–û–ö–†–ê–©–ï–ù–ù–û) ---
    function playSlots() {
        let b = parseInt(document.getElementById('slot-bet').value);
        if(b > coins) return; coins -= b;
        let s = ["üçí","üçã","üíé","7Ô∏è‚É£"];
        let r = [s[Math.floor(Math.random()*4)], s[Math.floor(Math.random()*4)], s[Math.floor(Math.random()*4)]];
        document.getElementById('s1').innerText = r[0];
        document.getElementById('s2').innerText = r[1];
        document.getElementById('s3').innerText = r[2];
        if(r[0]===r[1] && r[1]===r[2]) { coins += b*10; snd.jackpot.play(); }
        else if(r[0]===r[1] || r[1]===r[2] || r[0]===r[2]) { coins += b*1.5; snd.win.play(); }
        updateUI();
    }

    let cM = 1.0, cInt, isC = false, cB;
    function startCrash() {
        let b = parseInt(document.getElementById('crash-bet').value);
        if(b > coins || isC) return;
        coins -= b; cB = b; isC = true; cM = 1.0;
        document.getElementById('btn-crash-start').disabled = true;
        document.getElementById('btn-crash-cashout').disabled = false;
        let boom = 1.1 + Math.random()*3;
        cInt = setInterval(() => {
            cM += 0.05; document.getElementById('crash-display').innerText = cM.toFixed(2)+"x";
            if(cM >= boom) { clearInterval(cInt); isC = false; document.getElementById('btn-crash-start').disabled = false; document.getElementById('crash-display').innerText = "BOOM!"; }
        }, 100);
    }
    function cashoutCrash() { if(!isC) return; coins += Math.floor(cB*cM); clearInterval(cInt); isC=false; document.getElementById('btn-crash-start').disabled = false; updateUI(); }

    // --- –ë–ê–ó–û–í–´–ï –§–£–ù–ö–¶–ò–ò ---
    function makeClick(e) {
        if(energy <= 0) return;
        coins += clickPower; energy--; updateUI();
        if(!musicStarted) { snd.music.play(); musicStarted = true; }
    }

    function openTab(name) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('tab-' + name).classList.add('active-tab');
        document.getElementById('n-' + name).classList.add('active');
    }

    function updateUI() {
        document.getElementById('coins').innerText = Math.floor(coins);
        document.getElementById('energy').innerText = energy;
        document.getElementById('prof-total').innerText = Math.floor(totalEarned);
        saveData();
    }

    function saveData() { localStorage.setItem('burmalda_cities_save', JSON.stringify({coins, income, clickPower, cars, totalEarned})); }
    function loadData() {
        let d = JSON.parse(localStorage.getItem('burmalda_cities_save'));
        if(d) { coins=d.coins; income=d.income; clickPower=d.clickPower; cars=d.cars; totalEarned=d.totalEarned; }
    }
    function resetGame() { localStorage.clear(); location.reload(); }
</script>
</body>
</html>
