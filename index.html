<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Burmalda Universe</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #f1c40f; --green: #2ecc71; --red: #e74c3c; --bg: #121212; --panel: #1f1f1f; }
        body { font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: white; margin: 0; text-align: center; user-select: none; overflow: hidden; }
        
        /* –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ */
        .top-bar { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: var(--panel); border-bottom: 2px solid #333; }
        .stats-main { text-align: left; }
        .balance { font-size: 20px; color: var(--gold); font-weight: bold; }
        .energy-bar { font-size: 12px; color: var(--green); }
        .top-btns { display: flex; gap: 10px; }
        .icon-btn { background: #333; border: none; border-radius: 8px; color: white; padding: 8px; cursor: pointer; font-size: 18px; }

        .tab-content { display: none; padding: 20px; height: calc(100vh - 140px); overflow-y: auto; }
        .active-tab { display: block; }

        /* –ö–õ–ò–ö–ï–† */
        .click-area { height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .click-btn { 
            width: 220px; height: 220px; border-radius: 50%; border: 8px solid #333; 
            background: var(--gold); color: black; font-size: 24px; font-weight: bold;
            box-shadow: 0 0 30px rgba(241, 196, 15, 0.3); transition: transform 0.05s;
        }
        .click-btn:active { transform: scale(0.92); }

        /* –ö–ê–ó–ò–ù–û –ò –ö–ù–ë */
        .game-card { background: var(--panel); padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #333; }
        .slot-machine { display: flex; justify-content: center; gap: 8px; margin: 15px 0; perspective: 1000px; }
        .slot { 
            width: 65px; height: 80px; background: #000; border-radius: 10px; border: 2px solid var(--gold);
            font-size: 40px; line-height: 80px; position: relative; overflow: hidden;
        }
        .spinning { animation: slotScroll 0.1s infinite linear; }
        @keyframes slotScroll { 0% { transform: rotateX(0deg); filter: blur(2px); } 100% { transform: rotateX(360deg); filter: blur(5px); } }
        
        .rpc-btns { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
        .rpc-btn { background: #444; border: none; padding: 15px; border-radius: 10px; font-size: 25px; flex: 1; }

        /* –ú–ê–ì–ê–ó–ò–ù –ò –ù–ï–î–í–ò–ñ–ö–ê */
        .list-item { background: var(--panel); padding: 12px; margin: 10px 0; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--gold); }
        .list-item b { font-size: 15px; }
        .list-item span { font-size: 12px; color: #aaa; display: block; }
        .buy-btn { background: var(--green); border: none; color: white; padding: 8px 12px; border-radius: 6px; font-weight: bold; }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .nav { position: fixed; bottom: 0; width: 100%; background: var(--panel); display: flex; height: 70px; border-top: 2px solid #333; }
        .nav-btn { flex: 1; background: none; border: none; color: #777; font-size: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px; }
        .nav-btn.active { color: var(--gold); }
        .nav-btn i { font-size: 20px; }

        /* –ù–ê–°–¢–†–û–ô–ö–ò */
        .switch-row { display: flex; justify-content: space-between; padding: 15px; background: #222; margin: 10px 0; border-radius: 10px; }

        input { background: #333; color: white; border: 1px solid #444; padding: 10px; border-radius: 8px; width: 80%; text-align: center; }
    </style>
</head>
<body onload="loadData()">

<div class="top-bar">
    <div class="stats-main">
        <div class="balance"><span id="coins">0</span> ü™ô</div>
        <div class="energy-bar">‚ö° <span id="energy">1000</span>/1000</div>
    </div>
    <div class="top-btns">
        <button class="icon-btn" onclick="openTab('shop', this)">üõí</button>
        <button class="icon-btn" onclick="openTab('settings', this)">‚öôÔ∏è</button>
        <button class="icon-btn" onclick="openTab('profile', this)">üë§</button>
    </div>
</div>

<div id="tab-clicker" class="tab-content active-tab">
    <div class="click-area">
        <div id="status-msg" style="height: 20px; color: var(--red); margin-bottom: 10px; font-weight: bold;"></div>
        <button class="click-btn" onclick="makeClick()">–ë–£–†–ú–ê–õ–î–ê</button>
        <p id="multiplier-info" style="color: var(--gold); margin-top: 15px; font-size: 14px;"></p>
    </div>
</div>

<div id="tab-games" class="tab-content">
    <div class="game-card">
        <h3>–ö–ê–ó–ò–ù–û</h3>
        <div class="slot-machine">
            <div class="slot" id="s1">üé∞</div>
            <div class="slot" id="s2">üé∞</div>
            <div class="slot" id="s3">üé∞</div>
        </div>
        <input type="number" id="bet-amount" placeholder="–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞">
        <button onclick="playCasino()" style="width: 100%; margin-top: 10px; padding: 12px; background: var(--red); border: none; border-radius: 8px; color: white; font-weight: bold;">–ö–†–£–¢–ò–¢–¨</button>
        <div style="font-size: 10px; color: #888; margin-top: 10px; line-height: 1.5;">
            üíéüíéüíé (x100) - 1% | üçãüçãüçã (x5) - 10% | üçíüçíüçí (x2) - 20%
        </div>
    </div>

    <div class="game-card">
        <h3>–ö–ê–ú–ï–ù–¨-–ù–û–ñ–ù–ò–¶–´-–ë–£–ú–ê–ì–ê</h3>
        <div id="rpc-result" style="font-size: 18px; margin: 10px;">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç</div>
        <div class="rpc-btns">
            <button class="rpc-btn" onclick="playRPC('ü™®')">ü™®</button>
            <button class="rpc-btn" onclick="playRPC('‚úÇÔ∏è')">‚úÇÔ∏è</button>
            <button class="rpc-btn" onclick="playRPC('üìÑ')">üìÑ</button>
        </div>
        <p style="font-size: 12px; color: #aaa;">–°—Ç–∞–≤–∫–∞: 50 ü™ô | –ü–æ–±–µ–¥–∞: 150 ü™ô</p>
    </div>
</div>

<div id="tab-realty" class="tab-content">
    <h3>–ù–ï–î–í–ò–ñ–ò–ú–û–°–¢–¨</h3>
    <div class="list-item">
        <div><b>–õ–∞—á—É–≥–∞ –≤ –ª–µ—Å—É</b><span>+5 ü™ô / —Å–µ–∫</span></div>
        <button class="buy-btn" id="realty-0" onclick="buyRealty(0, 2000)">2000</button>
    </div>
    <div class="list-item">
        <div><b>–ö–≤–∞—Ä—Ç–∏—Ä–∞ –≤ —Ö—Ä—É—â–µ–≤–∫–µ</b><span>+20 ü™ô / —Å–µ–∫</span></div>
        <button class="buy-btn" id="realty-1" onclick="buyRealty(1, 10000)">10000</button>
    </div>
    <div class="list-item">
        <div><b>–ü–µ–Ω—Ç—Ö–∞—É—Å –≤ –°–∏—Ç–∏</b><span>+100 ü™ô / —Å–µ–∫</span></div>
        <button class="buy-btn" id="realty-2" onclick="buyRealty(2, 50000)">50000</button>
    </div>
</div>

<div id="tab-shop" class="tab-content">
    <h3>–ú–ê–ì–ê–ó–ò–ù</h3>
    <div class="list-item">
        <div><b>–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫</b><span>x2 –∫–ª–∏–∫ (40–º)</span></div>
        <button class="buy-btn" onclick="buyItem('energy-drink', 500)">500</button>
    </div>
    <div class="list-item">
        <div><b>–°–∞–ª–∞—Ç–∏–∫</b><span>+500 —ç–Ω–µ—Ä–≥–∏–∏</span></div>
        <button class="buy-btn" onclick="buyItem('salad', 400)">400</button>
    </div>
    <div class="list-item">
        <div><b>–ß–µ—á–µ–≤–∏—á–Ω—ã–π —Å—É–ø</b><span>+700 —ç–Ω–µ—Ä–≥–∏–∏</span></div>
        <button class="buy-btn" onclick="buyItem('soup', 600)">600</button>
    </div>
</div>

<div id="tab-profile" class="tab-content">
    <h3>–í–ê–® –ü–†–û–§–ò–õ–¨</h3>
    <div class="game-card" style="text-align: left;">
        <p>üí∞ –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <span id="p-total">0</span></p>
        <p>üè† –í–ª–∞–¥–µ–Ω–∏–π: <span id="p-realty">0</span></p>
        <p>üìâ –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥: <span id="p-income">0</span>/—Å–µ–∫</p>
    </div>
</div>

<div id="tab-settings" class="tab-content">
    <h3>–ù–ê–°–¢–†–û–ô–ö–ò</h3>
    <div class="switch-row">
        <span>–ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã</span>
        <input type="checkbox" id="sett-sound" checked style="width: 20px;">
    </div>
    <div class="switch-row">
        <span>–í–∏–±—Ä–∞—Ü–∏—è (Haptic)</span>
        <input type="checkbox" id="sett-haptic" checked style="width: 20px;">
    </div>
    <button onclick="resetGame()" style="background: var(--red); color: white; border: none; padding: 10px; width: 100%; border-radius: 10px; margin-top: 20px;">–°–ë–†–û–°–ò–¢–¨ –ü–†–û–ì–†–ï–°–°</button>
</div>

<div class="nav">
    <button class="nav-btn active" onclick="openTab('clicker', this)"><i>üñ±Ô∏è</i>–ö–ª–∏–∫–µ—Ä</button>
    <button class="nav-btn" onclick="openTab('games', this)"><i>üé≤</i>–ò–≥—Ä—ã</button>
    <button class="nav-btn" onclick="openTab('realty', this)"><i>üè¢</i>–ù–µ–¥–≤–∏–∂–∫–∞</button>
</div>

<script>
    let coins = 0;
    let energy = 1000;
    let clickMult = 1;
    let income = 0;
    let totalEarned = 0;
    let realtyOwned = [0, 0, 0];
    let isSpinning = false;

    const tg = window.Telegram.WebApp;
    tg.expand();

    const sounds = {
        click: new Audio('click.mp3'),
        win: new Audio('win.mp3'),
        loss: new Audio('loss.mp3'),
        mellfan: new Audio('mellfan.mp3'),
        salad: new Audio('salad.mp3'),
        soup: new Audio('soup.mp3'),
        build: new Audio('build.mp3'),
        rpc_win: new Audio('rpc_win.mp3'),
        rpc_draw: new Audio('rpc_draw.mp3')
    };

    function playSnd(name) {
        if (document.getElementById('sett-sound').checked) {
            sounds[name].currentTime = 0;
            sounds[name].play().catch(() => {});
        }
    }

    function doHaptic() {
        if (document.getElementById('sett-haptic').checked && tg.HapticFeedback) {
            tg.HapticFeedback.impactOccurred('light');
        }
    }

    function updateUI() {
        document.getElementById('coins').innerText = Math.floor(coins);
        document.getElementById('energy').innerText = energy;
        document.getElementById('p-total').innerText = Math.floor(totalEarned);
        document.getElementById('p-realty').innerText = realtyOwned.reduce((a, b) => a + b, 0);
        document.getElementById('p-income').innerText = income;
    }

    function openTab(name, btn) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('tab-' + name).classList.add('active-tab');
        if (btn.classList.contains('nav-btn')) btn.classList.add('active');
        playSnd('click');
    }

    function makeClick() {
        if (energy <= 0) { showMsg("–ù–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏!"); return; }
        if (Math.random() < 0.005) {
            coins = Math.max(0, coins - 100);
            showMsg("MELLFAN -100 ü™ô");
            playSnd('mellfan');
        } else {
            let add = 1 * clickMult;
            coins += add;
            totalEarned += add;
            energy -= 1;
            playSnd('click');
            doHaptic();
        }
        updateUI();
        saveData();
    }

    // –ö–ê–ó–ò–ù–û
    function playCasino() {
        if (isSpinning) return;
        let bet = parseInt(document.getElementById('bet-amount').value);
        if (isNaN(bet) || bet <= 0 || bet > coins) { tg.showAlert("–ú–∞–ª–æ –º–æ–Ω–µ—Ç!"); return; }

        isSpinning = true;
        coins -= bet;
        updateUI();

        const s1 = document.getElementById('s1'), s2 = document.getElementById('s2'), s3 = document.getElementById('s3');
        [s1, s2, s3].forEach(s => s.classList.add('spinning'));
        playSnd('click');

        setTimeout(() => {
            [s1, s2, s3].forEach(s => s.classList.remove('spinning'));
            let r = Math.random() * 100;
            let res = [];
            if (r < 1) { res = ['üíé','üíé','üíé']; coins += bet*100; playSnd('win'); }
            else if (r < 11) { res = ['üçã','üçã','üçã']; coins += bet*5; playSnd('win'); }
            else if (r < 31) { res = ['üçí','üçí','üçí']; coins += bet*2; playSnd('win'); }
            else { res = ['üí©','ü§°','7Ô∏è‚É£']; playSnd('loss'); }
            
            s1.innerText = res[0]; s2.innerText = res[1]; s3.innerText = res[2];
            isSpinning = false;
            updateUI();
            saveData();
        }, 1200);
    }

    // –ö–ù–ë
    function playRPC(user) {
        if (coins < 50) { tg.showAlert("–ù—É–∂–Ω–æ 50 –º–æ–Ω–µ—Ç!"); return; }
        coins -= 50;
        const items = ['ü™®', '‚úÇÔ∏è', 'üìÑ'];
        const comp = items[Math.floor(Math.random()*3)];
        let resTxt = "";
        
        if (user === comp) { resTxt = "–ù–∏—á—å—è! ü§ù"; coins += 50; playSnd('rpc_draw'); }
        else if ((user === 'ü™®' && comp === '‚úÇÔ∏è') || (user === '‚úÇÔ∏è' && comp === 'üìÑ') || (user === 'üìÑ' && comp === 'ü™®')) {
            resTxt = "–ü–æ–±–µ–¥–∞! +150 ü™ô"; coins += 150; totalEarned += 100; playSnd('rpc_win');
        } else { resTxt = "–ü—Ä–æ–∏–≥—Ä—ã—à... ü§°"; playSnd('loss'); }
        
        document.getElementById('rpc-result').innerText = `–¢—ã: ${user} | –ë–æ—Ç: ${comp} \n ${resTxt}`;
        updateUI();
        saveData();
    }

    // –ù–ï–î–í–ò–ñ–ò–ú–û–°–¢–¨
    const realtyData = [ {id:0, price:2000, inc:5}, {id:1, price:10000, inc:20}, {id:2, price:50000, inc:100} ];
    function buyRealty(idx, price) {
        if (coins < price) { tg.showAlert("–î–µ–Ω–µ–≥ –Ω–µ—Ç!"); return; }
        coins -= price;
        realtyOwned[idx]++;
        income += realtyData[idx].inc;
        playSnd('build');
        updateUI();
        saveData();
    }

    function buyItem(id, p) {
        if (coins < p) { tg.showAlert("–ù–∏—â–µ–±—Ä–æ–¥!"); return; }
        coins -= p;
        if (id === 'energy-drink') {
            clickMult = 2; playSnd('click');
            setTimeout(() => { clickMult = 1; }, 2400000);
        } else {
            playSnd(id);
            if (id === 'salad') energy = Math.min(1000, energy + 500);
            if (id === 'soup') energy = Math.min(1000, energy + 700);
        }
        updateUI();
        saveData();
    }

    // –°–ò–°–¢–ï–ú–ê –î–û–•–û–î–ê
    setInterval(() => {
        if (income > 0) {
            coins += income;
            totalEarned += income;
            updateUI();
        }
    }, 1000);

    function showMsg(t) { document.getElementById('status-msg').innerText = t; setTimeout(() => document.getElementById('status-msg').innerText="", 3000); }
    
    function saveData() { localStorage.setItem('burm_v3', JSON.stringify({coins, energy, income, totalEarned, realtyOwned})); }
    function loadData() {
        let d = JSON.parse(localStorage.getItem('burm_v3'));
        if (d) {
            coins = d.coins; energy = d.energy; income = d.income;
            totalEarned = d.totalEarned; realtyOwned = d.realtyOwned || [0,0,0];
            updateUI();
        }
    }
    function resetGame() { if(confirm("–£–¥–∞–ª–∏—Ç—å –≤—Å—ë?")) { localStorage.clear(); location.reload(); } }
</script>
</body>
</html>
